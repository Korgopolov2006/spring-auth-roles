# Инструкции по заполнению базы данных

## Обзор
Этот проект использует базу данных PostgreSQL с именем `YP4SpringAuthorizathion` и содержит систему аутентификации с тремя ролями: USER, ADMIN, MODERATOR.

## Файлы скриптов

### 1. `complete_database_fill_script.sql` - Полный скрипт
- Создает таблицы (если не существуют)
- Создает индексы для оптимизации
- Заполняет тестовыми данными
- Включает проверки и статистику
- Безопасен для повторного запуска

### 2. `quick_database_fill.sql` - Быстрый скрипт
- Минимальная версия для быстрого заполнения
- Очищает существующие данные
- Создает только необходимые таблицы
- Быстро заполняет тестовыми данными

## Как использовать

### Вариант 1: Через psql (рекомендуется)
```bash
# Открыть командную строку PostgreSQL
psql -U postgres

# Выполнить полный скрипт
\i complete_database_fill_script.sql

# Или быстрый скрипт
\i quick_database_fill.sql
```

### Вариант 2: Через pgAdmin
1. Открыть pgAdmin
2. Подключиться к серверу PostgreSQL
3. Выбрать базу данных `YP4SpringAuthorizathion`
4. Открыть Query Tool
5. Скопировать и вставить содержимое скрипта
6. Выполнить (F5)

### Вариант 3: Через командную строку
```bash
# Полный скрипт
psql -U postgres -d YP4SpringAuthorizathion -f complete_database_fill_script.sql

# Быстрый скрипт
psql -U postgres -d YP4SpringAuthorizathion -f quick_database_fill.sql
```

## Тестовые пользователи

После выполнения скрипта будут созданы следующие пользователи:

| Пользователь | Пароль | Роль | Описание |
|-------------|--------|------|----------|
| admin | password123 | ADMIN | Полный доступ ко всем функциям |
| moderator | password123 | MODERATOR | Доступ к модерации и просмотру пользователей |
| user | password123 | USER | Обычный пользователь |
| test | password123 | USER | Тестовый пользователь |
| demo | password123 | USER | Демонстрационный пользователь |

## Структура базы данных

### Таблица `model_user`
- `id_user` - Уникальный идентификатор (BIGSERIAL)
- `username` - Имя пользователя (VARCHAR(50), UNIQUE)
- `password` - Хешированный пароль (VARCHAR(255))
- `active` - Статус активности (BOOLEAN)

### Таблица `user_role`
- `user_id` - Ссылка на пользователя (BIGINT)
- `roles` - Роль пользователя (VARCHAR(20))
- Составной первичный ключ (user_id, roles)

## Настройки приложения

Убедитесь, что в `application.yml` правильно настроено подключение:

```yaml
spring:
    datasource:
        url: jdbc:postgresql://localhost:5432/YP4SpringAuthorizathion
        username: postgres
        password: 1
```

## Проверка работы

После выполнения скрипта:

1. Запустите Spring Boot приложение:
   ```bash
   .\mvnw.cmd spring-boot:run
   ```

2. Откройте браузер и перейдите на:
   - http://localhost:8080/login

3. Войдите с любым из тестовых пользователей

4. Проверьте разные роли:
   - ADMIN: http://localhost:8080/admin/dashboard
   - MODERATOR: http://localhost:8080/moderator/dashboard
   - USER: http://localhost:8080/user/dashboard

## Возможные проблемы

### Ошибка подключения к базе данных
- Проверьте, что PostgreSQL запущен
- Убедитесь, что база данных `YP4SpringAuthorizathion` существует
- Проверьте правильность пароля в `application.yml`

### Ошибка "пользователь не найден"
- Убедитесь, что скрипт выполнился без ошибок
- Проверьте, что пользователи созданы в базе данных

### Ошибка "роль не найдена"
- Проверьте, что роли назначены пользователям
- Убедитесь, что используется правильный формат ролей (USER, ADMIN, MODERATOR)

## Дополнительная информация

- Пароли закодированы с помощью BCrypt
- Сессия автоматически завершается через 15 минут
- Реализована валидация паролей (минимум 8 символов, заглавные/строчные буквы, цифры, спецсимволы)
- Поддерживается автоматический выход при неактивности

