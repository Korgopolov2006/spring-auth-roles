# СЛОВАРЬ ДАННЫХ - МАГАЗИН ЭЛЕКТРОНИКИ TECHSTORE

## 1. ТАБЛИЦА: model_user (Пользователи)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id_user | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор пользователя | 1, 2, 3... |
| username | VARCHAR(50) | UNIQUE, NOT NULL | Имя пользователя для входа в систему | "admin", "user123" |
| password | VARCHAR(255) | NOT NULL | Зашифрованный пароль (BCrypt) | "$2a$08$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVEFDi" |
| active | BOOLEAN | DEFAULT true | Статус активности пользователя | true, false |

**Описание:** Основная таблица пользователей системы. Содержит учетные данные для входа и статус активности.

## 2. ТАБЛИЦА: user_role (Роли пользователей)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| user_id | BIGINT | PRIMARY KEY, FOREIGN KEY | Ссылка на пользователя | 1, 2, 3... |
| roles | VARCHAR(20) | PRIMARY KEY, NOT NULL | Роль пользователя | "ADMIN", "MODERATOR", "USER" |

**Описание:** Связующая таблица для связи многие-ко-многим между пользователями и ролями.

## 3. ТАБЛИЦА: categories (Категории товаров)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор категории | 1, 2, 3... |
| name | VARCHAR(100) | UNIQUE, NOT NULL | Название категории | "Смартфоны", "Ноутбуки" |
| description | TEXT | NULL | Описание категории | "Мобильные телефоны и аксессуары" |
| parent_id | BIGINT | FOREIGN KEY, NULL | Ссылка на родительскую категорию | 1, 2, NULL |
| is_active | BOOLEAN | DEFAULT true | Статус активности категории | true, false |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания записи | "2024-01-15 10:30:00" |

**Описание:** Иерархическая структура категорий товаров. Поддерживает вложенность через parent_id.

## 4. ТАБЛИЦА: manufacturers (Производители)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор производителя | 1, 2, 3... |
| name | VARCHAR(100) | UNIQUE, NOT NULL | Название производителя | "Apple", "Samsung" |
| country | VARCHAR(50) | NULL | Страна производителя | "США", "Южная Корея" |
| website | VARCHAR(255) | NULL | Официальный сайт | "https://apple.com" |
| description | TEXT | NULL | Описание производителя | "Американская корпорация" |
| logo_url | VARCHAR(255) | NULL | URL логотипа | "/images/logos/apple.png" |
| is_active | BOOLEAN | DEFAULT true | Статус активности | true, false |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |

**Описание:** Справочник производителей товаров с дополнительной информацией.

## 5. ТАБЛИЦА: products (Товары)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор товара | 1, 2, 3... |
| name | VARCHAR(255) | NOT NULL | Название товара | "iPhone 15 Pro" |
| description | TEXT | NULL | Описание товара | "Новейший смартфон Apple" |
| price | DECIMAL(10,2) | NOT NULL | Цена товара | 99999.00 |
| old_price | DECIMAL(10,2) | NULL | Старая цена (для скидок) | 109999.00 |
| sku | VARCHAR(100) | UNIQUE, NULL | Артикул товара | "IPH15PRO-256" |
| category_id | BIGINT | FOREIGN KEY, NULL | Ссылка на категорию | 1, 2, 3... |
| manufacturer_id | BIGINT | FOREIGN KEY, NULL | Ссылка на производителя | 1, 2, 3... |
| stock_quantity | INTEGER | DEFAULT 0 | Количество на складе | 50, 100, 0 |
| min_stock_level | INTEGER | DEFAULT 5 | Минимальный уровень запаса | 5, 10 |
| weight | DECIMAL(8,2) | NULL | Вес товара в граммах | 187.0, 2000.0 |
| dimensions | VARCHAR(50) | NULL | Размеры товара | "146.6 x 70.6 x 8.25" |
| warranty_months | INTEGER | NULL | Гарантия в месяцах | 12, 24 |
| is_active | BOOLEAN | DEFAULT true | Статус активности | true, false |
| is_featured | BOOLEAN | DEFAULT false | Рекомендуемый товар | true, false |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата обновления | "2024-01-15 10:30:00" |

**Описание:** Основная таблица товаров с полными характеристиками и связями.

## 6. ТАБЛИЦА: product_images (Изображения товаров)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор изображения | 1, 2, 3... |
| product_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на товар | 1, 2, 3... |
| image_url | VARCHAR(255) | NOT NULL | URL изображения | "/images/products/iphone15pro-1.jpg" |
| alt_text | VARCHAR(255) | NULL | Альтернативный текст | "iPhone 15 Pro - вид спереди" |
| is_primary | BOOLEAN | DEFAULT false | Основное изображение | true, false |
| sort_order | INTEGER | DEFAULT 0 | Порядок сортировки | 1, 2, 3... |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |

**Описание:** Множественные изображения для каждого товара с возможностью сортировки.

## 7. ТАБЛИЦА: product_specifications (Характеристики товаров)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор характеристики | 1, 2, 3... |
| product_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на товар | 1, 2, 3... |
| spec_name | VARCHAR(100) | NOT NULL | Название характеристики | "Экран", "Процессор" |
| spec_value | VARCHAR(255) | NOT NULL | Значение характеристики | "6.1 дюймов", "A17 Pro" |
| spec_unit | VARCHAR(20) | NULL | Единица измерения | "дюймов", "ГБ", "МП" |
| sort_order | INTEGER | DEFAULT 0 | Порядок сортировки | 1, 2, 3... |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |

**Описание:** Технические характеристики товаров в формате ключ-значение.

## 8. ТАБЛИЦА: product_reviews (Отзывы о товарах)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор отзыва | 1, 2, 3... |
| product_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на товар | 1, 2, 3... |
| user_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на пользователя | 1, 2, 3... |
| rating | INTEGER | CHECK (rating >= 1 AND rating <= 5) | Рейтинг от 1 до 5 | 1, 2, 3, 4, 5 |
| title | VARCHAR(255) | NULL | Заголовок отзыва | "Отличный телефон!" |
| comment | TEXT | NULL | Текст отзыва | "Очень доволен покупкой" |
| is_verified_purchase | BOOLEAN | DEFAULT false | Подтвержденная покупка | true, false |
| is_approved | BOOLEAN | DEFAULT false | Одобрен модератором | true, false |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата обновления | "2024-01-15 10:30:00" |

**Описание:** Отзывы пользователей о товарах с системой модерации.

## 9. ТАБЛИЦА: cart_items (Элементы корзины)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор элемента | 1, 2, 3... |
| user_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на пользователя | 1, 2, 3... |
| product_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на товар | 1, 2, 3... |
| quantity | INTEGER | NOT NULL, DEFAULT 1 | Количество товара | 1, 2, 5 |
| added_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата добавления | "2024-01-15 10:30:00" |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата обновления | "2024-01-15 10:30:00" |

**Описание:** Товары в корзине пользователя. UNIQUE(user_id, product_id) предотвращает дублирование.

## 10. ТАБЛИЦА: orders (Заказы)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор заказа | 1, 2, 3... |
| user_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на пользователя | 1, 2, 3... |
| order_number | VARCHAR(50) | UNIQUE, NOT NULL | Номер заказа | "ORD-1705123456789" |
| status | VARCHAR(20) | DEFAULT 'PENDING' | Статус заказа | "PENDING", "PROCESSING", "SHIPPED" |
| total_amount | DECIMAL(10,2) | NOT NULL | Общая сумма заказа | 99999.00 |
| shipping_cost | DECIMAL(10,2) | DEFAULT 0 | Стоимость доставки | 500.00, 0.00 |
| tax_amount | DECIMAL(10,2) | DEFAULT 0 | Сумма налога | 1000.00 |
| discount_amount | DECIMAL(10,2) | DEFAULT 0 | Сумма скидки | 5000.00 |
| payment_method | VARCHAR(50) | NULL | Способ оплаты | "CARD", "CASH" |
| payment_status | VARCHAR(20) | DEFAULT 'PENDING' | Статус оплаты | "PENDING", "PAID" |
| shipping_address | TEXT | NULL | Адрес доставки | "г. Москва, ул. Ленина, 1" |
| billing_address | TEXT | NULL | Адрес выставления счета | "г. Москва, ул. Ленина, 1" |
| notes | TEXT | NULL | Примечания к заказу | "Доставить после 18:00" |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата обновления | "2024-01-15 10:30:00" |

**Описание:** Заказы пользователей с полной информацией о доставке и оплате.

## 11. ТАБЛИЦА: order_items (Элементы заказа)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор элемента | 1, 2, 3... |
| order_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на заказ | 1, 2, 3... |
| product_id | BIGINT | FOREIGN KEY, NOT NULL | Ссылка на товар | 1, 2, 3... |
| product_name | VARCHAR(255) | NOT NULL | Название товара на момент заказа | "iPhone 15 Pro" |
| product_sku | VARCHAR(100) | NULL | Артикул товара на момент заказа | "IPH15PRO-256" |
| quantity | INTEGER | NOT NULL | Количество товара | 1, 2, 5 |
| unit_price | DECIMAL(10,2) | NOT NULL | Цена за единицу на момент заказа | 99999.00 |
| total_price | DECIMAL(10,2) | NOT NULL | Общая цена позиции | 99999.00 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |

**Описание:** Детализация заказа с сохранением информации о товарах на момент покупки.

## 12. ТАБЛИЦА: coupons (Купоны)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор купона | 1, 2, 3... |
| code | VARCHAR(50) | UNIQUE, NOT NULL | Код купона | "WELCOME10", "SAVE5000" |
| name | VARCHAR(100) | NOT NULL | Название купона | "Скидка 10% для новых клиентов" |
| description | TEXT | NULL | Описание купона | "Скидка 10% на первый заказ" |
| discount_type | VARCHAR(20) | NOT NULL | Тип скидки | "PERCENTAGE", "FIXED_AMOUNT" |
| discount_value | DECIMAL(10,2) | NOT NULL | Значение скидки | 10.00, 5000.00 |
| min_order_amount | DECIMAL(10,2) | DEFAULT 0 | Минимальная сумма заказа | 5000.00 |
| max_discount_amount | DECIMAL(10,2) | NULL | Максимальная сумма скидки | 10000.00 |
| usage_limit | INTEGER | NULL | Лимит использований | 100, 1000 |
| used_count | INTEGER | DEFAULT 0 | Количество использований | 5, 50 |
| is_active | BOOLEAN | DEFAULT true | Статус активности | true, false |
| valid_from | TIMESTAMP | NULL | Действует с | "2024-01-01 00:00:00" |
| valid_until | TIMESTAMP | NULL | Действует до | "2024-12-31 23:59:59" |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания | "2024-01-15 10:30:00" |

**Описание:** Система купонов и скидок с гибкими настройками.

## 13. ТАБЛИЦА: user_activity_log (Лог активности пользователей)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор записи | 1, 2, 3... |
| user_id | BIGINT | FOREIGN KEY, NULL | Ссылка на пользователя | 1, 2, 3... |
| action | VARCHAR(100) | NOT NULL | Действие пользователя | "LOGIN", "ADD_TO_CART" |
| entity_type | VARCHAR(50) | NULL | Тип сущности | "PRODUCT", "ORDER" |
| entity_id | BIGINT | NULL | ID сущности | 1, 2, 3... |
| details | JSONB | NULL | Детали действия | {"product_id": 1, "quantity": 2} |
| ip_address | INET | NULL | IP адрес пользователя | "192.168.1.1" |
| user_agent | TEXT | NULL | User Agent браузера | "Mozilla/5.0..." |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата действия | "2024-01-15 10:30:00" |

**Описание:** Логирование всех действий пользователей для аналитики и безопасности.

## 14. ТАБЛИЦА: system_settings (Настройки системы)

| Поле | Тип | Ограничения | Описание | Пример |
|------|-----|-------------|----------|---------|
| id | BIGSERIAL | PRIMARY KEY, NOT NULL | Уникальный идентификатор настройки | 1, 2, 3... |
| setting_key | VARCHAR(100) | UNIQUE, NOT NULL | Ключ настройки | "store_name", "free_shipping_threshold" |
| setting_value | TEXT | NULL | Значение настройки | "TechStore", "5000.00" |
| setting_type | VARCHAR(20) | DEFAULT 'STRING' | Тип настройки | "STRING", "NUMBER", "BOOLEAN" |
| description | TEXT | NULL | Описание настройки | "Название магазина" |
| is_public | BOOLEAN | DEFAULT false | Публичная настройка | true, false |
| updated_by | BIGINT | FOREIGN KEY, NULL | Обновлено пользователем | 1, 2, 3... |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата обновления | "2024-01-15 10:30:00" |

**Описание:** Гибкая система настроек приложения с поддержкой различных типов данных.

## 15. СВЯЗИ МЕЖДУ ТАБЛИЦАМИ

### 15.1. Основные связи (Foreign Keys)

| Таблица | Поле | Ссылается на | Тип связи | Описание |
|---------|------|-------------|-----------|----------|
| user_role | user_id | model_user.id_user | Many-to-One | Пользователь может иметь несколько ролей |
| categories | parent_id | categories.id | Self-Reference | Иерархия категорий |
| products | category_id | categories.id | Many-to-One | Товар принадлежит одной категории |
| products | manufacturer_id | manufacturers.id | Many-to-One | Товар принадлежит одному производителю |
| product_images | product_id | products.id | Many-to-One | Товар может иметь несколько изображений |
| product_specifications | product_id | products.id | Many-to-One | Товар может иметь несколько характеристик |
| product_reviews | product_id | products.id | Many-to-One | Товар может иметь несколько отзывов |
| product_reviews | user_id | model_user.id_user | Many-to-One | Пользователь может оставить несколько отзывов |
| cart_items | user_id | model_user.id_user | Many-to-One | Пользователь может иметь несколько товаров в корзине |
| cart_items | product_id | products.id | Many-to-One | Товар может быть в корзине у нескольких пользователей |
| orders | user_id | model_user.id_user | Many-to-One | Пользователь может иметь несколько заказов |
| order_items | order_id | orders.id | Many-to-One | Заказ может содержать несколько товаров |
| order_items | product_id | products.id | Many-to-One | Товар может быть в нескольких заказах |
| user_activity_log | user_id | model_user.id_user | Many-to-One | Пользователь может иметь множество записей активности |
| system_settings | updated_by | model_user.id_user | Many-to-One | Настройка может быть обновлена пользователем |

### 15.2. Ограничения целостности

| Ограничение | Таблица | Поле | Условие | Описание |
|-------------|---------|------|---------|----------|
| CHECK | product_reviews | rating | rating >= 1 AND rating <= 5 | Рейтинг от 1 до 5 звезд |
| UNIQUE | model_user | username | - | Уникальное имя пользователя |
| UNIQUE | categories | name | - | Уникальное название категории |
| UNIQUE | manufacturers | name | - | Уникальное название производителя |
| UNIQUE | products | sku | - | Уникальный артикул товара |
| UNIQUE | orders | order_number | - | Уникальный номер заказа |
| UNIQUE | coupons | code | - | Уникальный код купона |
| UNIQUE | system_settings | setting_key | - | Уникальный ключ настройки |
| UNIQUE | cart_items | (user_id, product_id) | - | Один товар один раз в корзине пользователя |

## 16. ИНДЕКСЫ ДЛЯ ОПТИМИЗАЦИИ

### 16.1. Основные индексы

| Таблица | Индекс | Поля | Тип | Назначение |
|---------|--------|------|-----|------------|
| model_user | idx_model_user_username | username | B-tree | Быстрый поиск по имени пользователя |
| products | idx_products_category | category_id | B-tree | Фильтрация товаров по категории |
| products | idx_products_manufacturer | manufacturer_id | B-tree | Фильтрация товаров по производителю |
| products | idx_products_price | price | B-tree | Сортировка по цене |
| products | idx_products_active | is_active | B-tree | Фильтрация активных товаров |
| products | idx_products_featured | is_featured | B-tree | Поиск рекомендуемых товаров |
| product_reviews | idx_reviews_product | product_id | B-tree | Отзывы по товару |
| product_reviews | idx_reviews_user | user_id | B-tree | Отзывы пользователя |
| product_reviews | idx_reviews_approved | is_approved | B-tree | Одобренные отзывы |
| orders | idx_orders_user | user_id | B-tree | Заказы пользователя |
| orders | idx_orders_status | status | B-tree | Фильтрация по статусу |
| orders | idx_orders_created | created_at | B-tree | Сортировка по дате |
| cart_items | idx_cart_user | user_id | B-tree | Товары в корзине пользователя |
| user_activity_log | idx_activity_user | user_id | B-tree | Активность пользователя |
| user_activity_log | idx_activity_created | created_at | B-tree | Сортировка по дате |

### 16.2. Составные индексы

| Таблица | Индекс | Поля | Назначение |
|---------|--------|------|------------|
| products | idx_products_category_active | (category_id, is_active) | Активные товары в категории |
| products | idx_products_manufacturer_active | (manufacturer_id, is_active) | Активные товары производителя |
| product_reviews | idx_reviews_product_approved | (product_id, is_approved) | Одобренные отзывы по товару |
| orders | idx_orders_user_status | (user_id, status) | Заказы пользователя по статусу |
| cart_items | idx_cart_user_product | (user_id, product_id) | Уникальность товара в корзине |

## 17. ТРИГГЕРЫ И ФУНКЦИИ

### 17.1. Автоматические обновления

| Таблица | Поле | Триггер | Описание |
|---------|------|---------|----------|
| products | updated_at | UPDATE | Обновление времени изменения при изменении записи |
| orders | updated_at | UPDATE | Обновление времени изменения при изменении заказа |
| product_reviews | updated_at | UPDATE | Обновление времени изменения при изменении отзыва |
| cart_items | updated_at | UPDATE | Обновление времени изменения при изменении корзины |
| system_settings | updated_at | UPDATE | Обновление времени изменения при изменении настройки |

### 17.2. Бизнес-логика

| Функция | Назначение | Описание |
|---------|------------|----------|
| update_stock_on_order | Обновление остатков | Уменьшение количества товара при заказе |
| update_coupon_usage | Обновление использования купона | Увеличение счетчика использований купона |
| validate_coupon | Валидация купона | Проверка срока действия и лимитов купона |
| calculate_order_total | Расчет суммы заказа | Подсчет общей суммы с учетом скидок и налогов |

## 18. ПРАВИЛА ВАЛИДАЦИИ

### 18.1. Обязательные поля

| Таблица | Поля | Описание |
|---------|------|----------|
| model_user | username, password | Имя пользователя и пароль обязательны |
| categories | name | Название категории обязательно |
| manufacturers | name | Название производителя обязательно |
| products | name, price | Название и цена товара обязательны |
| orders | user_id, order_number, total_amount | Пользователь, номер и сумма заказа обязательны |
| order_items | order_id, product_name, quantity, unit_price, total_price | Все поля элемента заказа обязательны |

### 18.2. Форматы данных

| Поле | Формат | Пример | Описание |
|------|--------|--------|----------|
| username | 3-50 символов, латиница | "user123" | Только латинские буквы и цифры |
| email | RFC 5322 | "user@example.com" | Валидный email адрес |
| phone | +7 (XXX) XXX-XX-XX | "+7 (999) 123-45-67" | Российский формат телефона |
| price | DECIMAL(10,2) | 99999.00 | Цена с двумя знаками после запятой |
| rating | 1-5 | 1, 2, 3, 4, 5 | Целое число от 1 до 5 |
| sku | A-Z, 0-9, -, _ | "IPH15PRO-256" | Артикул товара |
| order_number | ORD-XXXXXXXXX | "ORD-1705123456789" | Номер заказа с префиксом |

## 19. ОГРАНИЧЕНИЯ ПРОИЗВОДИТЕЛЬНОСТИ

### 19.1. Размеры таблиц

| Таблица | Ожидаемый размер | Стратегия |
|---------|------------------|-----------|
| model_user | 10,000 записей | Индексы на username |
| products | 100,000 записей | Партиционирование по категориям |
| product_reviews | 1,000,000 записей | Архивация старых отзывов |
| orders | 500,000 записей | Партиционирование по датам |
| user_activity_log | 10,000,000 записей | Ротация логов |

### 19.2. Оптимизация запросов

| Операция | Стратегия | Описание |
|----------|-----------|----------|
| Поиск товаров | Составные индексы | (category_id, is_active, price) |
| Отзывы | Фильтрация | Только одобренные отзывы |
| Заказы | Пагинация | Ограничение количества записей |
| Логи | Партиционирование | Разделение по месяцам |

## 20. БЕЗОПАСНОСТЬ ДАННЫХ

### 20.1. Шифрование

| Поле | Метод | Описание |
|------|-------|----------|
| password | BCrypt | Хеширование паролей с солью |
| payment_data | AES-256 | Шифрование платежных данных |
| personal_data | AES-256 | Шифрование персональных данных |

### 20.2. Доступ к данным

| Роль | Доступ | Ограничения |
|------|--------|-------------|
| ADMIN | Все таблицы | Полный доступ |
| MODERATOR | products, categories, manufacturers, reviews | Только просмотр и редактирование |
| USER | Собственные данные | Только свои заказы, корзина, отзывы |

### 20.3. Аудит

| Таблица | Логирование | Описание |
|---------|-------------|----------|
| model_user | user_activity_log | Все действия с пользователями |
| products | user_activity_log | Изменения товаров |
| orders | user_activity_log | Создание и изменение заказов |
| system_settings | user_activity_log | Изменение настроек системы |
